<!DOCTYPE html><html lang="en"><head><title>src/authentication</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="src/authentication"><meta name="groc-project-path" content="src/authentication.js"><meta name="groc-github-url" content="https://github.com/evrythng/evrythng-js-sdk"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path"><a href="https://github.com/evrythng/evrythng-js-sdk/blob/master/src/authentication.js">src/authentication.js</a></div></div><div id="document"><div class="segment"><div class="comments "><div class="wrapper"><h2 id="authenticationjs">AUTHENTICATION.JS</h2></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>Authentication provides a complete abstraction layer on top of
the provided <em>'/auth/...'</em> endpoints in the REST API. Logging in with
Evrythng or Facebook uses the same method and provide a similar response.</strong></p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>Authentication with Facebook needs an app that has been created using the
<code>facebook: true</code> option, which will load and init the Facebook SDK.</strong></p></div></div><div class="code"><div class="wrapper"><span class="nx">define</span><span class="p">([</span>
  <span class="s1">&#39;core&#39;</span><span class="p">,</span>
  <span class="s1">&#39;rsvp&#39;</span><span class="p">,</span>
  <span class="s1">&#39;social/facebook&#39;</span><span class="p">,</span>
  <span class="s1">&#39;utils&#39;</span><span class="p">,</span>
  <span class="s1">&#39;ajax&#39;</span>
<span class="p">],</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">EVT</span><span class="p">,</span> <span class="nx">RSVP</span><span class="p">,</span> <span class="nx">Facebook</span><span class="p">,</span> <span class="nx">Utils</span><span class="p">)</span> <span class="p">{</span>
  <span class="s1">&#39;use strict&#39;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Login into Evryhtng. This method is attached to the <code>EVT.App</code> API methods.
Currently allowed authentication methods are <strong>evrythng</strong> and <strong>facebook</strong>.
The login  accepts:</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><ul>
<li><strong><em>login('facebook')</strong>: the normal third-party Facebook login pop-up</em></li>
<li><strong><em>login('facebook', fbOptions)</strong>: use fbOptions to pass facebook scope
permissions (see the
<a href="https://developers.facebook.com/docs/reference/javascript/FB.login/v2.0">Facebook login API reference</a>).</em></li>
<li><strong><em>login('facebook', fbOptions, successCb, errorCb)</strong>: same as previous,
with callbacks</em></li>
<li><strong><em>login('facebook', successCb, errorCb</strong>: no custom Facebook options</em></li>
<li><strong><em>login('evrythng', evtCredentials)</strong>: evtCredentials is an object with
<code>email</code> or <code>id</code> and <code>password</code> properties</em></li>
<li><strong><em>login('evrythng', evtCredentials, successCb, errorCb)</strong>: same as previous,
with callbacks</em></li>
</ul></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The <em>evrythng</em> login methods allow to omit the first parameter. Thus, the
following authenticates with Evrythng:</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><pre><code> app.login({
   email/id: "userEmailOrId",
   password: "pass"
 });
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">login</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">customOptions</span><span class="p">,</span> <span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">successCb</span> <span class="o">=</span> <span class="nx">successCallback</span><span class="p">,</span>
      <span class="nx">errorCb</span> <span class="o">=</span> <span class="nx">errorCallback</span><span class="p">;</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">type</span><span class="p">){</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Credentials (for Evrythng) or type (for Third party) are missing.&#39;</span><span class="p">);</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Authenticate using third parties' OAuth.</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span><span class="p">(</span><span class="nx">Utils</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">type</span><span class="p">)){</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;facebook&#39;</span><span class="p">){</span>
        <span class="k">return</span> <span class="nx">_loginFacebook</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">customOptions</span><span class="p">,</span> <span class="nx">successCb</span><span class="p">,</span> <span class="nx">errorCb</span><span class="p">);</span>

      <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;evrythng&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_loginEvrythng</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">customOptions</span><span class="p">,</span> <span class="nx">successCb</span><span class="p">,</span> <span class="nx">errorCb</span><span class="p">);</span>
      <span class="p">}</span>

      <span class="cm">/*TODO: add more authentication methods here.*/</span>

    <span class="p">}</span><span class="k">else</span><span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Evrythng login does not need first param. Simply call <em>_loginEvrythng()</em>
with shifted arguments.</p></div></div><div class="code"><div class="wrapper">      <span class="k">return</span> <span class="nx">_loginEvrythng</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">customOptions</span><span class="p">,</span> <span class="nx">successCb</span><span class="p">);</span>

    <span class="p">}</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Login with Facebook. Custom Options are optional.</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>Default Facebook scope permission is simply <em>'email'</em>. If your application
needs more than that, please read about Facebook login options and permissions
on their
<a href="https://developers.facebook.com/docs/reference/javascript/FB.login/v2.0">Developer Docs</a></strong>.</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_loginFacebook</span><span class="p">(</span><span class="nx">customOptions</span><span class="p">,</span> <span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span><span class="nx">scope</span><span class="o">:</span> <span class="s1">&#39;email&#39;</span><span class="p">},</span>
      <span class="nx">$this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If there are no facebook custom options, callbacks can start in first param.</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span><span class="p">(</span><span class="nx">Utils</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">customOptions</span><span class="p">)</span> <span class="o">||</span> <span class="nx">customOptions</span> <span class="o">===</span> <span class="kc">null</span><span class="p">){</span>

      <span class="kd">var</span> <span class="nx">tmp</span> <span class="o">=</span> <span class="nx">successCallback</span><span class="p">;</span>
      <span class="nx">successCallback</span> <span class="o">=</span> <span class="nx">customOptions</span><span class="p">;</span>
      <span class="nx">errorCallback</span> <span class="o">=</span> <span class="nx">tmp</span><span class="p">;</span>

    <span class="p">}</span><span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">Utils</span><span class="p">.</span><span class="nx">isObject</span><span class="p">(</span><span class="nx">customOptions</span><span class="p">)){</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If there are custom FB options, use this instead of the defaults.</p></div></div><div class="code"><div class="wrapper">      <span class="nx">options</span> <span class="o">=</span> <span class="nx">customOptions</span><span class="p">;</span>

    <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Return promise and resolve only once authenticated with EVRYTHNG.</p></div></div><div class="code"><div class="wrapper">    <span class="k">return</span> <span class="k">new</span> <span class="nx">RSVP</span><span class="p">.</span><span class="nx">Promise</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Login using Facebook with options above.</p></div></div><div class="code"><div class="wrapper">      <span class="nx">Facebook</span><span class="p">.</span><span class="nx">login</span><span class="p">(</span><span class="nx">options</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">userResponse</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If successful, authenticate with Evrythng, apply <em>successCb</em> and resolve
promise. Our own <em>Facebook.login()</em> method (defined in the <a href="social/facebook.html"><code>social/facebook</code>
module</a>) already resolves with the user information.
In this case, we add Evrythng access data to this already wrapped response.</p></div></div><div class="code"><div class="wrapper">        <span class="nx">authFacebook</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">$this</span><span class="p">,</span> <span class="nx">userResponse</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">fullResponse</span><span class="p">)</span> <span class="p">{</span>

          <span class="k">if</span> <span class="p">(</span><span class="nx">successCallback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">successCallback</span><span class="p">(</span><span class="nx">fullResponse</span><span class="p">);}</span>
          <span class="nx">resolve</span><span class="p">(</span><span class="nx">fullResponse</span><span class="p">);</span>

        <span class="p">});</span>

      <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Login was not successful, apply <em>errorCb</em> and reject promise. Response
has Facebook's <em>authResponse</em> and <em>status</em> objects.</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span><span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">errorCallback</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span> <span class="p">}</span>
        <span class="nx">reject</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>

      <span class="p">});</span>

    <span class="p">});</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Login with Evrythng using either the <em>email</em> or <em>id</em> properties.</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_loginEvrythng</span><span class="p">(</span><span class="nx">credentials</span><span class="p">,</span> <span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="o">!</span><span class="nx">credentials</span> <span class="o">||</span> <span class="nx">Utils</span><span class="p">.</span><span class="nx">isFunction</span><span class="p">(</span><span class="nx">credentials</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;Credentials are missing.&#39;</span><span class="p">);</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Send the authentication request to the REST API, which is a Promise.
Note that the context is passed from the above <em>app.login()</em> method
until the raw call in order to pass the correct scope's Api Key.</p></div></div><div class="code"><div class="wrapper">    <span class="k">return</span> <span class="nx">_authEvrythng</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">credentials</span><span class="p">).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">userResponse</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Login was successful, apply callback and propagate response to the
next promise handler.</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span><span class="p">(</span><span class="nx">successCallback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">successCallback</span><span class="p">(</span><span class="nx">userResponse</span><span class="p">);</span> <span class="p">}</span>
      <span class="k">return</span> <span class="nx">userResponse</span><span class="p">;</span>

    <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Login was not successful, call error callback and re-throw error.</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span><span class="p">(</span><span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">errorCallback</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span> <span class="p">}</span>
      <span class="k">throw</span> <span class="nx">response</span><span class="p">;</span>

    <span class="p">});</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Send authentication request with the Facebook auth token. This method is
used on explicit login and when Facebook is initialized in the <code>EVT.App</code>
constructor.</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">authFacebook</span><span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">EVT</span><span class="p">.</span><span class="nx">api</span><span class="p">({</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/auth/facebook&#39;</span><span class="p">,</span>
      <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span>
        <span class="nx">access</span><span class="o">:</span> <span class="p">{</span>
          <span class="nx">token</span><span class="o">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">authResponse</span><span class="p">.</span><span class="nx">accessToken</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">authorization</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">access</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create User Scope with the user information and Api Key returned
from the REST API.</p></div></div><div class="code"><div class="wrapper">      <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EVT</span><span class="p">.</span><span class="nx">User</span><span class="p">({</span>
        <span class="nx">id</span><span class="o">:</span> <span class="nx">access</span><span class="p">.</span><span class="nx">evrythngUser</span><span class="p">,</span>
        <span class="nx">apiKey</span><span class="o">:</span> <span class="nx">access</span><span class="p">.</span><span class="nx">evrythngApiKey</span>
      <span class="p">},</span> <span class="nx">$this</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Prepare resolve object. Move Facebook user data to
'user.facebook' object</p></div></div><div class="code"><div class="wrapper">      <span class="nx">Utils</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">user</span><span class="p">,</span> <span class="p">{</span> <span class="nx">facebook</span><span class="o">:</span> <span class="nx">response</span><span class="p">.</span><span class="nx">user</span> <span class="p">},</span> <span class="kc">true</span><span class="p">);</span>
      <span class="nx">response</span><span class="p">.</span><span class="nx">user</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>

      <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>

    <span class="p">});</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Send authentication request using Evrythng credentials.</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_authEvrythng</span><span class="p">(</span><span class="nx">credentials</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">EVT</span><span class="p">.</span><span class="nx">api</span><span class="p">({</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/auth/evrythng&#39;</span><span class="p">,</span>
      <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="nx">credentials</span><span class="p">,</span>
      <span class="nx">authorization</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span>
    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">access</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Once it is authenticated, get this user information as well.</p></div></div><div class="code"><div class="wrapper">      <span class="k">return</span> <span class="nx">EVT</span><span class="p">.</span><span class="nx">api</span><span class="p">({</span>
        <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/users/&#39;</span> <span class="o">+</span> <span class="nx">access</span><span class="p">.</span><span class="nx">evrythngUser</span><span class="p">,</span>
        <span class="nx">authorization</span><span class="o">:</span> <span class="nx">access</span><span class="p">.</span><span class="nx">evrythngApiKey</span>
      <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">userInfo</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Keep nested success handler because we also need the <em>access</em>
object returned form the previous call to create the User Scope.</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">userObj</span> <span class="o">=</span> <span class="nx">Utils</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">userInfo</span><span class="p">,</span> <span class="p">{</span>
          <span class="nx">id</span><span class="o">:</span> <span class="nx">access</span><span class="p">.</span><span class="nx">evrythngUser</span><span class="p">,</span>
          <span class="nx">apiKey</span><span class="o">:</span> <span class="nx">access</span><span class="p">.</span><span class="nx">evrythngApiKey</span>
        <span class="p">});</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Create User Scope</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">EVT</span><span class="p">.</span><span class="nx">User</span><span class="p">(</span><span class="nx">userObj</span><span class="p">,</span> <span class="nx">$this</span><span class="p">);</span>

        <span class="k">return</span> <span class="p">{</span> <span class="nx">user</span><span class="o">:</span> <span class="nx">user</span> <span class="p">};</span>

      <span class="p">});</span>

    <span class="p">});</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>The <em>logout()</em> method behaves similarly to <em>login()</em>. The user should
specify the type of logout they want (<strong><em>evrythng</em> is default</strong>).</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If an application logs in with Facebook, and simply logs out of
Evrythng, then the Facebook user will continue connected until its FB
token expires (which is most of the times not what you want).</p></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p><strong>As a good practice, if you log into an app with Facebook, also log
out with Facebook. This allows app users to switch Facebook accounts.</strong></p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">logout</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">&amp;&amp;</span> <span class="nx">Utils</span><span class="p">.</span><span class="nx">isString</span><span class="p">(</span><span class="nx">type</span><span class="p">)){</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;facebook&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_logoutFacebook</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">);</span>

      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;evrythng&#39;</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">_logoutEvrythng</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">);</span>
      <span class="p">}</span>

    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">return</span> <span class="nx">_logoutEvrythng</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">successCallback</span><span class="p">);</span>
    <span class="p">}</span>

  <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Logging out with Facebook, logs out out from Facebook and also from
Evrythng.</p></div></div><div class="code"><div class="wrapper">  <span class="kd">function</span> <span class="nx">_logoutFacebook</span><span class="p">(</span><span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">$this</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>

    <span class="k">return</span> <span class="nx">Facebook</span><span class="p">.</span><span class="nx">logout</span><span class="p">().</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If successful (always), also logout from Evrythng.</p></div></div><div class="code"><div class="wrapper">      <span class="k">return</span> <span class="nx">_logoutEvrythng</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">$this</span><span class="p">,</span> <span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">);</span>

    <span class="p">});</span>
  <span class="p">}</span>


  <span class="kd">function</span> <span class="nx">_logoutEvrythng</span><span class="p">(</span><span class="nx">successCallback</span><span class="p">,</span> <span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span>

    <span class="k">return</span> <span class="nx">EVT</span><span class="p">.</span><span class="nx">api</span><span class="p">({</span>
      <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;/auth/all/logout&#39;</span><span class="p">,</span>
      <span class="nx">method</span><span class="o">:</span> <span class="s1">&#39;post&#39;</span><span class="p">,</span>
      <span class="nx">authorization</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">apiKey</span>

    <span class="p">}).</span><span class="nx">then</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>

      <span class="k">if</span><span class="p">(</span><span class="nx">successCallback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">successCallback</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span> <span class="p">}</span>
      <span class="k">return</span> <span class="nx">response</span><span class="p">;</span>

    <span class="p">},</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>If the logout from Evrythng fails, by some reason, throw error
which would go to the promise error handler of the caller.</p></div></div><div class="code"><div class="wrapper">      <span class="k">if</span><span class="p">(</span><span class="nx">errorCallback</span><span class="p">)</span> <span class="p">{</span> <span class="nx">errorCallback</span><span class="p">(</span><span class="nx">err</span><span class="p">);</span> <span class="p">}</span>
      <span class="k">throw</span> <span class="nx">err</span><span class="p">;</span>

    <span class="p">});</span>
  <span class="p">}</span></div></div></div><div class="segment"><div class="comments "><div class="wrapper"><p>Expose only the higher level methods.</p></div></div><div class="code"><div class="wrapper">  <span class="k">return</span> <span class="p">{</span>
    <span class="nx">login</span><span class="o">:</span> <span class="nx">login</span><span class="p">,</span>
    <span class="nx">logout</span><span class="o">:</span> <span class="nx">logout</span><span class="p">,</span>
    <span class="nx">authFacebook</span><span class="o">:</span> <span class="nx">authFacebook</span>
  <span class="p">};</span>

<span class="p">});</span></div></div></div></div></body></html>