!function(a,b){"function"==typeof define&&define.amd?define(b(XMLHttpRequest)):"object"==typeof exports?module.exports=b(require("w3c-xmlhttprequest").XMLHttpRequest):a.EVT=a.Evrythng=b(XMLHttpRequest)}(this,function(a){var b,c,d;return function(a){function e(a,b){var c,d,e,f,g,h,i,j,k,l,m=b&&b.split("/"),n=p.map,o=n&&n["*"]||{};if(a&&"."===a.charAt(0)&&b){for(m=m.slice(0,m.length-1),a=m.concat(a.split("/")),j=0;l=a[j];j++)if("."===l)a.splice(j,1),j-=1;else if(".."===l){if(1===j&&(".."===a[2]||".."===a[0]))return!0;j>0&&(a.splice(j-1,2),j-=2)}a=a.join("/")}if((m||o)&&n){for(c=a.split("/"),j=c.length;j>0;j-=1){if(d=c.slice(0,j).join("/"),m)for(k=m.length;k>0;k-=1)if(e=n[m.slice(0,k).join("/")],e&&(e=e[d])){f=e,g=j;break}if(f)break;!h&&o&&o[d]&&(h=o[d],i=j)}!f&&h&&(f=h,g=i),f&&(c.splice(0,g,f),a=c.join("/"))}return a}function f(b,c){return function(){return m.apply(a,r.call(arguments,0).concat([b,c]))}}function g(a){return function(b){return e(b,a)}}function h(a){return function(b){n[a]=b}}function i(b){if(o.hasOwnProperty(b)){var c=o[b];delete o[b],q[b]=!0,l.apply(a,c)}if(!n.hasOwnProperty(b))throw new Error("No "+b);return n[b]}function j(a,b){var c,d,f=a.indexOf("!");return-1!==f?(c=e(a.slice(0,f),b),a=a.slice(f+1),d=i(c),a=d&&d.normalize?d.normalize(a,g(b)):e(a,b)):a=e(a,b),{f:c?c+"!"+a:a,n:a,p:d}}function k(a){return function(){return p&&p.config&&p.config[a]||{}}}var l,m,n={},o={},p={},q={},r=[].slice;l=function(b,c,d,e){var g,l,m,p,r,s,t=[];if(e=e||b,"function"==typeof d){for(c=!c.length&&d.length?["require","exports","module"]:c,s=0;s<c.length;s++)if(r=j(c[s],e),m=r.f,"require"===m)t[s]=f(b);else if("exports"===m)t[s]=n[b]={},g=!0;else if("module"===m)l=t[s]={id:b,uri:"",exports:n[b],config:k(b)};else if(n.hasOwnProperty(m)||o.hasOwnProperty(m))t[s]=i(m);else if(r.p)r.p.load(r.n,f(e,!0),h(m),{}),t[s]=n[m];else if(!q[m])throw new Error(b+" missing "+m);p=d.apply(n[b],t),b&&(l&&l.exports!==a&&l.exports!==n[b]?n[b]=l.exports:p===a&&g||(n[b]=p))}else b&&(n[b]=d)},b=c=m=function(b,c,d,e){return"string"==typeof b?i(j(b,c).f):(b.splice||(p=b,c.splice?(b=c,c=d,d=null):b=a),c=c||function(){},e?l(a,b,c,d):setTimeout(function(){l(a,b,c,d)},15),m)},m.config=function(a){return p=a,m},d=function(a,b,c){b.splice||(c=b,b=[]),o[a]=[a,b,c]},d.amd={jQuery:!0}}(),d("almond",function(){}),d("utils",[],function(){return{isFunction:function(a){return"[object Function]"==Object.prototype.toString.call(a)},isString:function(a){return"[object String]"==Object.prototype.toString.call(a)},isArray:function(a){return"[object Array]"==Object.prototype.toString.call(a)},isObject:function(a){return a===Object(a)&&!this.isArray(a)},extend:function(a,b,c){var d;if(c)d=a;else{d={};for(var e in a)d[e]=a[e]}for(var f in b)b.hasOwnProperty(f)&&(d[f]=b[f]);return d},buildParams:function(a){var b=[];for(var c in a)a.hasOwnProperty(c)&&void 0!==a[c]&&b.push(encodeURIComponent(c)+"="+encodeURIComponent(a[c]));return b.join("&")},buildUrl:function(a){var b=a.url||"";return a.params&&(b+=(-1===b.indexOf("?")?"?":"&")+this.buildParams(a.params)),b}}}),d("core",["utils"],function(a){var b="2.0.0",c={apiUrl:"https://api.evrythng.com",async:!0,fullResponse:!1,geolocation:!0},d={version:b,settings:c,setup:function(b){if(!a.isObject(b))throw new TypeError("Setup should be called with an options object.");return this.settings=a.extend(this.settings,b),this.settings}};return d}),d("scope/scope",["utils"],function(a){var b=function(b){if(this.parentScope=null,!a.isString(b))throw new TypeError("Scope constructor should be called with API Key.");this.apiKey=b};return b}),d("logger",[],function(){var a="EvrythngJS";return{error:function(b){console.error(a+" Error: ",b)},info:function(b){console.info(a+" Info: ",b)}}}),d("rsvp/all",["./promise","exports"],function(a,b){var c=a["default"];b["default"]=function(a,b){return c.all(a,b)}}),d("rsvp/all_settled",["./promise","./utils","exports"],function(a,b,c){function d(a){return{state:"fulfilled",value:a}}function e(a){return{state:"rejected",reason:a}}var f=a["default"],g=b.isArray,h=b.isNonThenable;c["default"]=function(a,b){return new f(function(b){function c(a){return function(b){j(a,d(b))}}function i(a){return function(b){j(a,e(b))}}function j(a,c){m[a]=c,0===--l&&b(m)}if(!g(a))throw new TypeError("You must pass an array to allSettled.");var k,l=a.length;if(0===l)return void b([]);for(var m=new Array(l),n=0;n<a.length;n++)k=a[n],h(k)?j(n,d(k)):f.resolve(k).then(c(n),i(n))},b)}}),d("rsvp/asap",["exports"],function(a){function b(){return function(){process.nextTick(e)}}function c(){var a=0,b=new h(e),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}function d(){return function(){setTimeout(e,1)}}function e(){for(var a=0;a<i.length;a++){var b=i[a],c=b[0],d=b[1];c(d)}i=[]}a["default"]=function(a,b){var c=i.push([a,b]);1===c&&f()};var f,g="undefined"!=typeof window?window:{},h=g.MutationObserver||g.WebKitMutationObserver,i=[];f="undefined"!=typeof process&&"[object process]"==={}.toString.call(process)?b():h?c():d()}),d("rsvp/config",["./events","exports"],function(a,b){function c(a,b){return"onerror"===a?void e.on("error",b):2!==arguments.length?e[a]:void(e[a]=b)}var d=a["default"],e={instrument:!1};d.mixin(e),b.config=e,b.configure=c}),d("rsvp/defer",["./promise","exports"],function(a,b){var c=a["default"];b["default"]=function(a){var b={};return b.promise=new c(function(a,c){b.resolve=a,b.reject=c},a),b}}),d("rsvp/events",["exports"],function(a){var b=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},c=function(a){var b=a._promiseCallbacks;return b||(b=a._promiseCallbacks={}),b};a["default"]={mixin:function(a){return a.on=this.on,a.off=this.off,a.trigger=this.trigger,a._promiseCallbacks=void 0,a},on:function(a,d){var e,f=c(this);e=f[a],e||(e=f[a]=[]),-1===b(e,d)&&e.push(d)},off:function(a,d){var e,f,g=c(this);return d?(e=g[a],f=b(e,d),void(-1!==f&&e.splice(f,1))):void(g[a]=[])},trigger:function(a,b){var d,e,f=c(this);if(d=f[a])for(var g=0;g<d.length;g++)(e=d[g])(b)}}}),d("rsvp/filter",["./all","./map","./utils","exports"],function(a,b,c,d){function e(a,b,c){return f(a,c).then(function(d){if(!i(a))throw new TypeError("You must pass an array to filter.");if(!h(b))throw new TypeError("You must pass a function to filter's second argument.");return g(a,b,c).then(function(a){var b,c=d.length,e=[];for(b=0;c>b;b++)a[b]&&e.push(d[b]);return e})})}var f=a["default"],g=b["default"],h=c.isFunction,i=c.isArray;d["default"]=e}),d("rsvp/hash",["./promise","./utils","exports"],function(a,b,c){var d=a["default"],e=b.isNonThenable,f=b.keysOf;c["default"]=function(a){return new d(function(b,c){function g(a){return function(c){k[a]=c,0===--m&&b(k)}}function h(a){m=0,c(a)}var i,j,k={},l=f(a),m=l.length;if(0===m)return void b(k);for(var n=0;n<l.length;n++)j=l[n],i=a[j],e(i)?(k[j]=i,0===--m&&b(k)):d.resolve(i).then(g(j),h)})}}),d("rsvp/hash_settled",["./promise","./utils","exports"],function(a,b,c){function d(a){return{state:"fulfilled",value:a}}function e(a){return{state:"rejected",reason:a}}var f=a["default"],g=b.isNonThenable,h=b.keysOf;c["default"]=function(a){return new f(function(b){function c(a){return function(b){j(a,d(b))}}function i(a){return function(b){j(a,e(b))}}function j(a,c){m[a]=c,0===--o&&b(m)}var k,l,m={},n=h(a),o=n.length;if(0===o)return void b(m);for(var p=0;p<n.length;p++)l=n[p],k=a[l],g(k)?j(l,d(k)):f.resolve(k).then(c(l),i(l))})}}),d("rsvp/instrument",["./config","./utils","exports"],function(a,b,c){var d=a.config,e=b.now;c["default"]=function(a,b,c){try{d.trigger(a,{guid:b._guidKey+b._id,eventName:a,detail:b._detail,childGuid:c&&b._guidKey+c._id,label:b._label,timeStamp:e(),stack:new Error(b._label).stack})}catch(f){setTimeout(function(){throw f},0)}}}),d("rsvp/map",["./promise","./utils","exports"],function(a,b,c){var d=a["default"],e=b.isArray,f=b.isFunction;c["default"]=function(a,b,c){return d.all(a,c).then(function(g){if(!e(a))throw new TypeError("You must pass an array to map.");if(!f(b))throw new TypeError("You must pass a function to map's second argument.");var h,i=g.length,j=[];for(h=0;i>h;h++)j.push(b(g[h]));return d.all(j,c)})}}),d("rsvp/node",["./promise","./utils","exports"],function(a,b,c){var d=a["default"],e=b.isArray;c["default"]=function(a,b){return function(){for(var c=arguments.length,f=new Array(c),g=0;c>g;g++)f[g]=arguments[g];var h,i=b===!0,j=e(b);return i||j||!b?h=this:(console.warn('Deprecation: RSVP.denodeify() doesn\'t allow setting the "this" binding anymore. Use yourFunction.bind(yourThis) instead.'),h=b),d.all(f).then(function(c){function e(d,e){function f(){for(var a=arguments.length,c=new Array(a),f=0;a>f;f++)c[f]=arguments[f];var g=c[0],h=c[1];if(g)e(g);else if(i)d(c.slice(1));else if(j){var k,l,m={},n=c.slice(1);for(l=0;l<b.length;l++)k=b[l],m[k]=n[l];d(m)}else d(h)}c.push(f),a.apply(h,c)}return new d(e)})}}}),d("rsvp/promise",["./config","./events","./instrument","./utils","./promise/cast","./promise/all","./promise/race","./promise/resolve","./promise/reject","exports"],function(a,b,c,d,e,f,g,h,i,j){function k(){}function l(a,b){if(!z(a))throw new TypeError("You must pass a resolver function as the first argument to the promise constructor");if(!(this instanceof l))throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.");this._id=H++,this._label=b,this._subscribers=[],w.instrument&&x("created",this),k!==a&&m(a,this)}function m(a,b){function c(a){r(b,a)}function d(a){t(b,a)}try{a(c,d)}catch(e){d(e)}}function n(a,b,c,d){var e=a._subscribers,f=e.length;e[f]=b,e[f+K]=c,e[f+L]=d}function o(a,b){var c,d,e=a._subscribers,f=a._detail;w.instrument&&x(b===K?"fulfilled":"rejected",a);for(var g=0;g<e.length;g+=3)c=e[g],d=e[g+b],p(b,c,d,f);a._subscribers=null}function p(a,b,c,d){var e,f,g,h,i=z(c);if(i)try{e=c(d),g=!0}catch(j){h=!0,f=j}else e=d,g=!0;q(b,e)||(i&&g?r(b,e):h?t(b,f):a===K?r(b,e):a===L&&t(b,e))}function q(a,b){var c,d=null;try{if(a===b)throw new TypeError("A promises callback cannot return that same promise.");if(y(b)&&(d=b.then,z(d)))return d.call(b,function(d){return c?!0:(c=!0,void(b!==d?r(a,d):s(a,d)))},function(b){return c?!0:(c=!0,void t(a,b))},"Settle: "+(a._label||" unknown promise")),!0}catch(e){return c?!0:(t(a,e),!0)}return!1}function r(a,b){a===b?s(a,b):q(a,b)||s(a,b)}function s(a,b){a._state===I&&(a._state=J,a._detail=b,w.async(u,a))}function t(a,b){a._state===I&&(a._state=J,a._detail=b,w.async(v,a))}function u(a){o(a,a._state=K)}function v(a){a._onerror&&a._onerror(a._detail),o(a,a._state=L)}var w=a.config,x=(b["default"],c["default"]),y=d.objectOrFunction,z=d.isFunction,A=d.now,B=e["default"],C=f["default"],D=g["default"],E=h["default"],F=i["default"],G="rsvp_"+A()+"-",H=0;j["default"]=l,l.cast=B,l.all=C,l.race=D,l.resolve=E,l.reject=F;var I=void 0,J=0,K=1,L=2;l.prototype={constructor:l,_id:void 0,_guidKey:G,_label:void 0,_state:void 0,_detail:void 0,_subscribers:void 0,_onerror:function(a){w.trigger("error",a)},then:function(a,b,c){var d=this;this._onerror=null;var e=new this.constructor(k,c);if(this._state){var f=arguments;w.async(function(){p(d._state,e,f[d._state-1],d._detail)})}else n(this,e,a,b);return w.instrument&&x("chained",d,e),e},"catch":function(a,b){return this.then(null,a,b)},"finally":function(a,b){var c=this.constructor;return this.then(function(b){return c.cast(a()).then(function(){return b})},function(b){return c.cast(a()).then(function(){throw b})},b)}}}),d("rsvp/promise/all",["../utils","exports"],function(a,b){var c=a.isArray,d=a.isNonThenable;b["default"]=function(a,b){var e=this;return new e(function(b,f){function g(a){return function(c){k[a]=c,0===--j&&b(k)}}function h(a){j=0,f(a)}if(!c(a))throw new TypeError("You must pass an array to all.");var i,j=a.length,k=new Array(j);if(0===j)return void b(k);for(var l=0;l<a.length;l++)i=a[l],d(i)?(k[l]=i,0===--j&&b(k)):e.resolve(i).then(g(l),h)},b)}}),d("rsvp/promise/cast",["exports"],function(a){a["default"]=function(a,b){var c=this;return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)},b)}}),d("rsvp/promise/race",["../utils","exports"],function(a,b){var c=a.isArray,d=(a.isFunction,a.isNonThenable);b["default"]=function(a,b){var e,f=this;return new f(function(b,g){function h(a){j&&(j=!1,b(a))}function i(a){j&&(j=!1,g(a))}if(!c(a))throw new TypeError("You must pass an array to race.");for(var j=!0,k=0;k<a.length;k++){if(e=a[k],d(e))return j=!1,void b(e);f.resolve(e).then(h,i)}},b)}}),d("rsvp/promise/reject",["exports"],function(a){a["default"]=function(a,b){var c=this;return new c(function(b,c){c(a)},b)}}),d("rsvp/promise/resolve",["exports"],function(a){a["default"]=function(a,b){var c=this;return a&&"object"==typeof a&&a.constructor===c?a:new c(function(b){b(a)},b)}}),d("rsvp/race",["./promise","exports"],function(a,b){var c=a["default"];b["default"]=function(a,b){return c.race(a,b)}}),d("rsvp/reject",["./promise","exports"],function(a,b){var c=a["default"];b["default"]=function(a,b){return c.reject(a,b)}}),d("rsvp/resolve",["./promise","exports"],function(a,b){var c=a["default"];b["default"]=function(a,b){return c.resolve(a,b)}}),d("rsvp/rethrow",["exports"],function(a){a["default"]=function(a){throw setTimeout(function(){throw a}),a}}),d("rsvp/utils",["exports"],function(a){function b(a){return"function"==typeof a||"object"==typeof a&&null!==a}function c(a){return"function"==typeof a}function d(a){return!b(a)}a.objectOrFunction=b,a.isFunction=c,a.isNonThenable=d;var e;e=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var f=e;a.isArray=f;var g=Date.now||function(){return(new Date).getTime()};a.now=g;var h=Object.keys||function(a){var b=[];for(var c in a)b.push(c);return b};a.keysOf=h}),d("rsvp",["./rsvp/promise","./rsvp/events","./rsvp/node","./rsvp/all","./rsvp/all_settled","./rsvp/race","./rsvp/hash","./rsvp/hash_settled","./rsvp/rethrow","./rsvp/defer","./rsvp/config","./rsvp/map","./rsvp/resolve","./rsvp/reject","./rsvp/filter","./rsvp/asap","exports"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){function r(a,b){E.async(a,b)}function s(){E.on.apply(E,arguments)}function t(){E.off.apply(E,arguments)}var u=a["default"],v=b["default"],w=c["default"],x=d["default"],y=e["default"],z=f["default"],A=g["default"],B=h["default"],C=i["default"],D=j["default"],E=k.config,F=k.configure,G=l["default"],H=m["default"],I=n["default"],J=o["default"],K=p["default"];if(E.async=K,"undefined"!=typeof window&&"object"==typeof window.__PROMISE_INSTRUMENTATION__){var L=window.__PROMISE_INSTRUMENTATION__;F("instrument",!0);for(var M in L)L.hasOwnProperty(M)&&s(M,L[M])}q.Promise=u,q.EventTarget=v,q.all=x,q.allSettled=y,q.race=z,q.hash=A,q.hashSettled=B,q.rethrow=C,q.defer=D,q.denodeify=w,q.configure=F,q.on=s,q.off=t,q.resolve=H,q.reject=I,q.async=r,q.map=G,q.filter=J}),d("ajax/cors",["core","rsvp","utils","logger"],function(b,c,d,e){function f(a,b){var c=a.responseText?JSON.parse(a.responseText):null;return b&&(c={data:c,headers:a.responseHeaders,status:a.status}),c}function g(a,b,c,d){var e={status:a.status,type:"cors",message:"Server responded with an error for the CORS request",url:b,method:c};return d&&(e.errors=d.errors),e}function h(b,c,d){var e=new a;return"withCredentials"in e?e.open(b,c,d):e=null,e}function i(a,b,i){a=a||{};var j=a.method||"get",k=void 0!==a.async?a.async:!0,l=d.buildUrl(a),m=h(j,l,k);if(m){var n=a.data?JSON.stringify(a.data):null;if(m.setRequestHeader("Content-Type","application/json"),a.authorization&&m.setRequestHeader("Authorization",a.authorization),k)return new c.Promise(function(c,d){function h(){if(this.readyState===this.DONE){var h=f(this,a.fullResponse);if(this.status>=200&&this.status<300)b&&b(h),c(h);else{var k=g(this,l,j,h);e.error(k),i&&i(k),d(k)}}}m.onreadystatechange=h,m.send(n)});m.send(n);var o=f(m,a.fullResponse);if(m.status>=200&&m.status<300)return o;throw e.error(g(m,l,j,o)),new Error("Synchronous CORS Request failed.")}var p=new Error("CORS not supported.");throw p.name="CorsError",p}return i}),d("ajax/jsonp",["core","rsvp","utils","logger"],function(a,b,c,d){function e(a,b,c,d){var e={status:b,type:"jsonp",message:"Server responded with an error for the JSONP request",url:a,method:c};return d&&(e.errors=d.errors),e}function f(a,b){var c=document.createElement("script"),d=!1;c.src=a,c.async=b,c.onload=c.onreadystatechange=function(){d||this.readyState&&"loaded"!==this.readyState&&"complete"!==this.readyState||(d=!0,c.onload=c.onreadystatechange=null,c&&c.parentNode&&c.parentNode.removeChild(c))},h||(h=document.getElementsByTagName("head")[0]),h.appendChild(c)}function g(a,g,h){a=a||{},a.url&&(a.url=a.url.replace("//api","//js-api"));var j="callback_json"+ ++i,k=a.params||{};k.callback=j,k.access_token=a.authorization,k.method=a.method||"get",k.data=JSON.stringify(a.data),a.params=k;var l=void 0!==a.async?a.async:!0,m=c.buildUrl(a);return new b.Promise(function(a,b){window[j]=function(c){if(c.errors&&c.status){var f=e(m,c.status,k.method,c);d.error(f),h&&h(f),b(f)}else g&&g(c),a(c);try{delete window[j]}catch(i){}window[j]=null},f(m,l,b)})}var h,i=0;return g}),d("ajax",["core","ajax/cors","ajax/jsonp","utils","logger"],function(a,b,c,d,e){function f(f,g,h){var i=d.extend({async:a.settings.async,fullResponse:a.settings.fullResponse},f);i.url=a.settings.apiUrl+i.url;var j,k;d.isFunction(g)?j=g:d.isFunction(f.success)&&(j=f.success),d.isFunction(h)?k=h:d.isFunction(f.error)&&(k=f.error);try{return b(i,j,k)}catch(l){if("CorsError"!==l.name)throw l;return e.info("CORS not supported. Continuing with JSONP..."),c(i,j,k)}}return a.api=f,a}),d("resource",["core","scope/scope","utils","logger","ajax"],function(a,b,c,d){function e(b,d,e,g){var h,i=e,j=g;return c.isFunction(d)||null===d?(i=d,j=e):c.isObject(d)&&(b=c.extend(d,b)),h=a.api(b,i,j),f.call(this,h,d)}function f(b,c){var d=c&&void 0!==c.async?c.async:a.settings.async;if(d){var e=this;return b.then(function(a){return e.parse(a)})}return b}var g=function(a,e,f){if(!(a&&a instanceof b))throw new TypeError("Scope should inherit from Scope (e.g. EVT.App).");if(this.scope=a,!c.isString(e))throw new TypeError("Resource must have a String path.");"/"!=e[0]&&(e="/"+e),this.path=e,c.isFunction(f)?c.isFunction(f.prototype.toJSON)?this["class"]=f:d.error('Class for resource "'+e+'" does not implement toJSON().'):d.info('Class for resource "'+e+'" undefined. It will not return proper Entities nor cascaded Entities.')};return g.prototype.parse=function(a){if(this["class"]&&a){if(c.isArray(a)){var b=[];for(var d in a)b.push(new this["class"](a[d],this));return b}return new this["class"](a,this)}return a},g.prototype.jsonify=function(a){return this["class"]&&a instanceof this["class"]?a.toJSON():a},g.prototype.create=function(a,b,d,f){if(!a||c.isFunction(a))throw new TypeError("Create method should have payload.");var g={url:this.path,method:"post",authorization:this.scope.apiKey,data:this.jsonify(a)};return e.call(this,g,b,d,f)},g.prototype.read=function(a,b,c){var d={url:this.path,authorization:this.scope.apiKey};return e.call(this,d,a,b,c)},g.prototype.update=function(a,b,d,f){if(!a||c.isFunction(a))throw new TypeError("Update method should have payload.");var g={url:this.path,method:"put",authorization:this.scope.apiKey,data:this.jsonify(a)};return e.call(this,g,b,d,f)},g.prototype["delete"]=function(a,b,c){var d={url:this.path,method:"delete",authorization:this.scope.apiKey};return e.call(this,d,a,b,c)},g.constructorFactory=function(a,b){return function(d){var e=a||"";if(d){if(!c.isString(d))throw new TypeError("ID must be a string");e+="/"+d}return new g(this,e,b)}},g}),d("entity/entity",["resource","utils"],function(a,b){var c=function(c,d){if(b.isObject(c))if(c instanceof a)this.resource=c;else if(this.resource=d,b.extend(this,c,!0),this.resource&&c.id){var e=this.resource.path.split("/");e[e.length-1]!==c.id&&(this.resource.path+="/"+c.id)}};return c.prototype.toJSON=function(){var a={};for(var c in this)this[c]&&!b.isFunction(this[c])&&"resource"!=c&&(a[c]=this[c]);return a},c.prototype.update=function(a){if(this.resource){var c=arguments,d=this;return(null===a||!a||b.isFunction(a))&&(c=Array.prototype.slice.call(arguments,0),c.unshift(this.toJSON())),this.resource.update.apply(this.resource,c).then(function(a){return b.extend(d,a,!0),a})}throw new Error("This entity has no resource")},c.prototype["delete"]=function(){if(this.resource)return this.resource["delete"].apply(this.resource,arguments);throw new Error("This entity has no resource")},c}),d("entity/property",["core","./entity","resource","utils"],function(a,b,c,d){function e(a){var b=a[0];if(d.isString(b))a[0]=[{value:b}];else if(d.isObject(b))if(b.value)a[0]=[b];else{a[0]=[];for(var c in b)a[0].push({key:c,value:b[c]})}return a}var f=function(){b.apply(this,arguments)};return f.prototype=Object.create(b.prototype),f.prototype.constructor=f,a.Property=f,{resourceConstructor:function(b){if(!this.resource)throw new Error("This Entity does not have a Resource.");var f,g=this.resource.path+"/properties";if(b){if(!d.isString(b))throw new TypeError("Property must be a key/name string");g+="/"+b}return f=new c(this.resource.scope,g,a.Property),f.update=function(){return c.prototype.update.apply(this,e(arguments))},f}}}),d("entity/product",["core","./entity","resource","./property","utils"],function(a,b,c,d,e){var f=function(){b.apply(this,arguments)};return f.prototype=Object.create(b.prototype),f.prototype.constructor=f,e.extend(f.prototype,{property:d.resourceConstructor},!0),a.Product=f,{resourceConstructor:c.constructorFactory("/products",a.Product)}}),d("entity/action",["core","./entity","resource","utils"],function(a,b,c,d){function e(a){var b=arguments;if(!a||d.isFunction(a)){var c=this.path.split("/"),e=c[c.length-1];b=Array.prototype.slice.call(arguments,0),b.unshift({type:e})}return b}var f=function(){b.apply(this,arguments)};return f.prototype=Object.create(b.prototype),f.prototype.constructor=f,a.Action=f,{resourceConstructor:function(b,f){var g,h;if(!b)throw new TypeError("Action type cannot be empty.");if(!d.isString(b))throw new TypeError("Action type must be a name string");return g="/actions/"+b,h=c.constructorFactory(g,a.Action).call(this,f),h.create=function(){var a=e.apply(this,arguments);return c.prototype.create.apply(this,a)},h}}}),d("entity/appUser",["core","./entity","resource","utils","ajax"],function(a,b,c,d){function e(b){if(!b||!d.isString(b))throw new Error("Activation code must be a string.");return a.api({url:this.path+"/validate",method:"post",authorization:this.scope.apiKey,data:{activationCode:b}})}var f=function(a){a.evrythngUser&&(a.id=a.evrythngUser,delete a.evrythngUser),b.apply(this,arguments)};return f.prototype=Object.create(b.prototype),f.prototype.constructor=f,d.extend(f.prototype,{validate:function(){return e.call(this.resource,this.activationCode)}},!0),a.AppUser=f,{resourceConstructor:function(b){var d=b||"/users";return function(b){var f=c.constructorFactory(d,a.AppUser).call(this,b);return f.validate=function(){return e.apply(this,arguments)},f}}}}),d("social/facebook",["rsvp","utils"],function(a,b){function c(b){return new a.Promise(function(a){window.fbAsyncInit=function(){FB.init({appId:b,version:"v2.0"}),FB.getLoginStatus(function(b){f(b).then(function(b){a(b)})})},function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/sdk.js",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk")})}function d(b){return new a.Promise(function(a,c){FB.login(function(b){f(b).then(function(b){b.user?a(b):c(b)})},b)})}function e(){return new a.Promise(function(a){FB.logout(a)})}function f(c){return new a.Promise("connected"==c.status?function(a){FB.api("/me",function(d){a(b.extend(c,{user:d}))})}:function(a){a(c)})}return{init:c,login:d,logout:e}}),d("authentication",["core","rsvp","social/facebook","utils","ajax"],function(a,b,c,d){function e(a,b,c,e){var h=c,i=e;if(!a)throw new TypeError("Credentials (for Evrythng) or type (for Third party) are missing.");return d.isString(a)?"facebook"===a?f.call(this,b,h,i):"evrythng"===a?g.call(this,b,h,i):void 0:g.call(this,a,b,h)}function f(a,e,f){var g={scope:"email"},i=this;if(d.isFunction(a)||null===a){var j=e;e=a,f=j}else d.isObject(a)&&(g=a);return new b.Promise(function(a,b){c.login(g).then(function(b){h.call(i,b).then(function(b){e&&e(b),a(b)})},function(a){f&&f(a),b(a)})})}function g(a,b,c){if(!a||d.isFunction(a))throw new TypeError("Credentials are missing.");return i.call(this,a).then(function(a){return b&&b(a),a},function(a){throw c&&c(a),a})}function h(b){var c=this;return a.api({url:"/auth/facebook",method:"post",data:{access:{token:b.authResponse.accessToken}},authorization:this.apiKey}).then(function(e){var f=new a.User({id:e.evrythngUser,apiKey:e.evrythngApiKey},c);return d.extend(f,{facebook:b.user},!0),b.user=f,b})}function i(b){var c=this;return a.api({url:"/auth/evrythng",method:"post",data:b,authorization:this.apiKey}).then(function(b){return a.api({url:"/users/"+b.evrythngUser,authorization:b.evrythngApiKey}).then(function(e){var f=d.extend(e,{id:b.evrythngUser,apiKey:b.evrythngApiKey}),g=new a.User(f,c);return{user:g}})})}function j(a,b,c){return a&&d.isString(a)?"facebook"===a?k.call(this,b,c):"evrythng"===a?l.call(this,b,c):void 0:l.call(this,a,b)}function k(a,b){var d=this;return c.logout().then(function(){return l.call(d,a,b)})}function l(b,c){return a.api({url:"/auth/all/logout",method:"post",authorization:this.apiKey}).then(function(a){return b&&b(a),a},function(a){throw c&&c(a),a})}return{login:e,logout:j,authFacebook:h}}),d("scope/application",["core","./scope","resource","entity/product","entity/action","entity/appUser","authentication","social/facebook","utils","logger","ajax"],function(a,b,c,d,e,f,g,h,i,j){var k=function(c){var d=this;i.isObject(c)?b.call(this,c.apiKey):b.call(this,c),this.$init=a.api({url:"/applications",authorization:this.apiKey}).then(function(a){return delete a[0].appApiKey,i.extend(d,a[0],!0)},function(){j.error("There is no application with this API Key.")}).then(function(a){return c.facebook?h.init(a.socialNetworks.facebook.appId).then(function(a){return"connected"===a.status?g.authFacebook.call(d,a):a}).then(function(b){return i.extend(b,{app:a})}):a})};return k.prototype=Object.create(b.prototype),k.prototype.constructor=k,i.extend(k.prototype,{product:d.resourceConstructor,action:e.resourceConstructor,appUser:f.resourceConstructor("/auth/evrythng/users"),login:g.login},!0),a.App=k,a}),d("entity/thng",["core","./entity","resource","./property","utils","ajax"],function(a,b,c,d,e){function f(){if(!this.product)throw new Error("Thng does not have a product.");if(!this.resource)throw new Error("Thng does not have a resource.");return this.resource.scope.product(this.product).read()}var g=function(){b.apply(this,arguments)};return g.prototype=Object.create(b.prototype),g.prototype.constructor=g,e.extend(g.prototype,{property:d.resourceConstructor,readProduct:f},!0),a.Thng=g,{resourceConstructor:c.constructorFactory("/thngs",a.Thng)}}),d("entity/collection",["core","./entity","resource","utils"],function(a,b,c,d){function e(b){if(!this.resource)throw new Error("This Entity does not have a Resource.");var d=this.resource.path+"/thngs";return c.constructorFactory(d,a.Thng).call(this.resource.scope,b)}var f=function(){b.apply(this,arguments)};return f.prototype=Object.create(b.prototype),f.prototype.constructor=f,d.extend(f.prototype,{thng:e},!0),a.Collection=f,{resourceConstructor:c.constructorFactory("/collections",a.Collection)}}),d("scope/user",["core","./scope","entity/product","entity/thng","entity/action","entity/appUser","entity/collection","authentication","utils"],function(a,b,c,d,e,f,g,h,i){function j(b,c){var d={};return i.isString(b)?(d.q=b,d=i.extend(d,c)):(d=b,c&&i.extend(d,c,!0)),a.api({url:"/search",params:d,authorization:this.apiKey})}function k(){var a=this,b=f.resourceConstructor().call(this,this.id);return b.update(arguments).then(function(b){return i.extend(a,b,!0),b})}var l=function(a,c){i.isObject(a)?(b.call(this,a.apiKey),i.extend(this,a,!0)):b.call(this,a),c instanceof b&&(this.parentScope=c)};return l.prototype=Object.create(b.prototype),l.prototype.constructor=l,i.extend(l.prototype,{product:c.resourceConstructor,action:e.resourceConstructor,thng:d.resourceConstructor,collection:g.resourceConstructor,logout:h.logout,search:j,update:k},!0),a.User=l,a}),d("evrythng",["scope/application","scope/user"],function(a){return a}),c("evrythng")});
//# sourceMappingURL=evrythng.min.map